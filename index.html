<!DOCTYPE html>
<!--
  index.html — Main application shell for the Health Navigation App

  Purpose:
  - Load core app shell elements (navigation bar, modal, content container)
  - Apply global styles and icon fonts
  - Provide Shadow DOM host (#content) where subpages are dynamically injected
-->
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>健康管理助手</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="./images/happy.png">
    <link rel="shortcut icon" type="image/png" href="./images/happy.png">
    <!-- System fonts preferred; remove Google icon fonts to avoid CN blocking -->

    <script>
      // Redirect to login page if user is not authenticated
      if (!localStorage.getItem("userId")) {
        window.location.href = "src/login.html";
      }
    </script>

    <link rel="stylesheet" href="./statics/css/animations.css" />
    <link rel="stylesheet" href="./statics/css/index.css" />
    <!-- Ionicons (Apple-style icons) - Local files -->
    <script type="module" src="./statics/libs/ionicons/ionicons/ionicons.esm.js"></script>
    <script nomodule src="./statics/libs/ionicons/ionicons.js"></script>

    <!-- Force icon font styles to remain consistent even if overridden by subpages -->
    <style>
      /* Ensure iconfont-based icons stay visible regardless of subpage styles */
      .iconfont {
        font-family: "iconfont" !important;
        font-style: normal;
        font-weight: normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      /* Ionicons default sizing for nav */
      ion-icon { width: 24px; height: 24px; }
    </style>
  </head>

  <body>
    <!-- Main content area (Shadow DOM host) where subpages load -->
    <div class="content" id="content"></div>

    <!-- Bottom navigation bar -->
    <div class="nav-container" role="tablist" aria-label="主导航">
      <!-- Daily tab -->
      <div class="nav-item" data-index="0">
        <button
          class="icon ripple"
          role="tab"
          aria-selected="false"
          aria-label="日常"
          title="日常"
        >
          <ion-icon ios="create-outline" md="create-sharp" aria-hidden="true"></ion-icon>
        </button>
        <div class="nav-label">日常</div>
      </div>
      <!-- Case tab -->
      <div class="nav-item" data-index="1">
        <button
          class="icon ripple"
          role="tab"
          aria-selected="false"
          aria-label="提醒"
          title="提醒"
        >
          <ion-icon ios="time-outline" md="time-sharp" aria-hidden="true"></ion-icon>
        </button>
        <div class="nav-label">提醒</div>
      </div>

      <!-- Center Add button -->
      <div class="center-button-wrapper">
        <div
          class="center-button"
          id="centerBtn"
          aria-label="新增"
          title="新增"
        >
          <ion-icon ios="add" md="add-sharp" aria-hidden="true"></ion-icon>
        </div>
      </div>

      <!-- Square tab -->
      <div class="nav-item" data-index="2">
        <button
          class="icon ripple"
          role="tab"
          aria-selected="false"
          aria-label="广场"
          title="广场"
        >
          <ion-icon ios="chatbubbles-outline" md="chatbubbles-sharp" aria-hidden="true"></ion-icon>
        </button>
        <div class="nav-label">广场</div>
      </div>
      <!-- Me tab -->
      <div class="nav-item" data-index="3">
        <button
          class="icon ripple"
          role="tab"
          aria-selected="false"
          aria-label="我的"
          title="我的"
        >
          <ion-icon ios="person-outline" md="person-sharp" aria-hidden="true"></ion-icon>
        </button>
        <div class="nav-label">我的</div>
      </div>

      <!-- Navigation active tab indicator -->
      <div class="indicator" id="indicator"></div>
    </div>

    <!-- Modal overlay and content container for center action -->
    <div class="modal" id="modal" style="display: none">
      <div class="modal-content" id="modalContent"></div>
    </div>

    <!-- 设备检测和安全区适配 - 必须最先加载 -->
    <script src="./statics/js/util/device-detection.js"></script>
    <!-- URL工具函数 - 解决Android设备URL问题 -->
    <script src="./statics/js/util/url-utils.js"></script>
    <!-- 震动反馈管理器 - 必须最先加载 -->
    <script src="./statics/js/util/haptic-manager.js"></script>
    <!-- 动画工具库 -->
    <script src="./statics/js/util/animation-utils.js"></script>
    <!-- 页面转场动画 -->
    <script src="./statics/js/util/page-transitions.js"></script>
    <!-- 动画性能监控 -->
    <script src="./statics/js/util/animation-performance.js"></script>
    <!-- 主题偏好管理（调用原生插件切换深浅色） -->
    <script src="./statics/js/util/theme-preference.js"></script>
    <!-- 状态栏管理 -->
    <script src="./statics/js/util/status-bar.js"></script>
    <!-- 统一弹窗管理器 -->
    <script src="./statics/js/util/modal-manager.js"></script>
    <!-- 官方Capacitor评分插件 -->
    <script src="./statics/js/official-rating.js"></script>
    <!-- 连胜庆祝动画 -->
    <script src="./statics/js/streak-celebration.js"></script>
    <!-- 浏览器通知封装（在 Capacitor 之前加载，提供浏览器环境下的通知支持） -->
    <script src="./statics/js/util/browser-notifications.js"></script>
    <!-- 打卡提醒日志系统（独立模块，必须在所有页面加载前可用） -->
    <script src="./statics/js/util/checkin-reminder-logger.js"></script>
    <!-- 打卡提醒核心函数（提前加载，确保提交页面可用） -->
    <script src="./statics/js/util/checkin-reminder-core.js"></script>
    <!-- 打卡提醒设置功能（提前加载，确保即使用户不打开设置页面也能预约提醒） -->
    <script src="./statics/js/settings.js"></script>
    <!-- App shell JavaScript: handles navigation, page loading, and modal interactions -->
    <script src="./statics/js/index.js"></script>
    <!-- Global AI heart + modal (outside Shadow DOM) -->
    <script src="./statics/js/ai-heart.js"></script>
  </body>
</html>
